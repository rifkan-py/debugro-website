---
import type { GetStaticPaths } from 'astro';
import { getCollection } from 'astro:content';
import type { CollectionEntry } from 'astro:content';
import Layout from '../../layouts/Layout.astro';

interface Props {
    post: CollectionEntry<'blogs'>;
}

// Generate paths for all blog posts
export const getStaticPaths: GetStaticPaths = async () => {
    const blogPosts = await getCollection('blogs');
    return blogPosts.map((post: CollectionEntry<'blogs'>) => ({
        params: { slug: post.slug },
        props: { post },
    }));
};

const { post } = Astro.props;
const { Content } = await post.render();

// Format date
const formatDate = (date: Date): string => {
    return new Date(date).toLocaleDateString('en-US', {
        year: 'numeric',
        month: 'long',
        day: 'numeric'
    });
};

interface SEOData {
    title: string;
    description: string;
    keywords: string;
    image: string;
    canonicalUrl: string;
}

const seoData: SEOData = {
    title: `${post.data.title} - Debugro Blog`,
    description: post.data.description,
    keywords: post.data.tags.join(', '),
    image: post.data.image,
    canonicalUrl: `https://debugro.com/blogs/${post.slug}`
};
---

<Layout {...seoData}>
    <main class="py-16 lg:py-20 min-h-screen bg-gradient-to-b from-[var(--color-primary-dark)] to-[#00151e]">
        <article class="container mx-auto px-4 md:px-6 max-w-7xl">
            <!-- Article Header -->
            <div class="max-w-3xl mx-auto mb-12">
                <div class="flex items-center gap-4 mb-6">
                    <a href="/blogs" class="text-[var(--color-primary)] hover:text-[var(--color-primary-light)] transition-colors">
                        ‚Üê Back to Blog
                    </a>
                    <span class="text-gray-400">|</span>
                    <span class="text-gray-400">{formatDate(post.data.pubDate)}</span>
                </div>

                <h1 class="text-4xl lg:text-5xl font-bold text-white mb-6">
                    {post.data.title}
                </h1>

                <!-- Author Info -->
                <div class="flex items-center gap-4 mb-8">
                    <img 
                        src={post.data.authorAvatar} 
                        alt={post.data.author}
                        class="w-12 h-12 rounded-full"
                    />
                    <div>
                        <div class="text-white font-medium">
                            {post.data.author}
                        </div>
                        <div class="text-gray-400 text-sm">
                            {post.data.authorRole}
                        </div>
                    </div>
                </div>

                <!-- Tags -->
                <div class="flex flex-wrap gap-2 mb-8">
                    {post.data.tags.map((tag: string) => (
                        <span class="px-3 py-1 rounded-full bg-[var(--color-primary)]/10 text-[var(--color-primary-light)] text-sm">
                            {tag}
                        </span>
                    ))}
                </div>

                <!-- Featured Image -->
                <div class="relative rounded-xl overflow-hidden mb-12">
                    <img 
                        src={post.data.image} 
                        alt={post.data.title}
                        class="w-full h-auto"
                    />
                </div>
            </div>

            <!-- Article Content -->
            <div class="max-w-3xl mx-auto prose prose-invert prose-lg prose-headings:text-white prose-headings:font-bold prose-h1:text-4xl prose-h2:text-3xl prose-h3:text-2xl prose-h4:text-xl prose-p:text-gray-300 prose-strong:text-white prose-strong:font-semibold prose-a:text-[var(--color-primary)] prose-a:no-underline hover:prose-a:text-[var(--color-primary-light)] prose-blockquote:border-[var(--color-primary)] prose-blockquote:bg-[var(--color-primary-dark)]/30 prose-blockquote:rounded-lg prose-blockquote:px-6 prose-blockquote:py-4 prose-blockquote:not-italic prose-table:border-collapse prose-th:border prose-th:border-[var(--color-primary-light-dark)] prose-th:p-2 prose-td:border prose-td:border-[var(--color-primary-light-dark)] prose-td:p-2 prose-img:rounded-xl prose-hr:border-[var(--color-primary-light-dark)]">
                <Content />
            </div>

            <!-- Share and Navigation -->
            <div class="max-w-3xl mx-auto mt-12 pt-8 border-t border-white/10">
                <div class="flex justify-between items-center">
                    <div class="text-gray-300">
                        Share this article:
                        <div class="flex gap-4 mt-2">
                            <a href={`https://twitter.com/intent/tweet?text=${post.data.title}&url=https://debugro.com/blogs/${post.slug}`}
                                target="_blank"
                                rel="noopener noreferrer"
                                class="text-gray-400 hover:text-[var(--color-primary)] transition-colors">
                                Twitter
                            </a>
                            <a href={`https://www.linkedin.com/shareArticle?mini=true&url=https://debugro.com/blogs/${post.slug}&title=${post.data.title}`}
                                target="_blank"
                                rel="noopener noreferrer"
                                class="text-gray-400 hover:text-[var(--color-primary)] transition-colors">
                                LinkedIn
                            </a>
                        </div>
                    </div>
                    <div class="text-gray-300">
                        Reading time: {post.data.readTime}
                    </div>
                </div>
            </div>
        </article>
    </main>
</Layout>
